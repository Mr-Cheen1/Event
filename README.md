<p align="center">
  <img src="event.png" width="150">
</p>

<p align="center">
  <a href="https://github.com/Mr-Cheen1/Event/actions/workflows/lint.yml"><img src="https://github.com/Mr-Cheen1/Event/actions/workflows/lint.yml/badge.svg" alt="Lint Status"/></a>
  <a href="https://github.com/Mr-Cheen1/Event/actions/workflows/test.yml"><img src="https://github.com/Mr-Cheen1/Event/actions/workflows/test.yml/badge.svg" alt="Test Status"/></a>
  <a href="https://github.com/Mr-Cheen1/Event/actions/workflows/build.yml"><img src="https://github.com/Mr-Cheen1/Event/actions/workflows/build.yml/badge.svg" alt="Build Status"/></a>
</p>
# Telegram-бот для напоминания о событиях

Этот проект представляет собой Telegram-бота, который отправляет напоминания о предстоящих событиях, таких как дни рождения и годовщины.

## Особенности

- Отправка уведомлений о событиях в заданное время
- Поддержка различных часовых поясов
- Напоминания за 2 дня до события и в день события
- Конфигурация через JSON-файлы

## Требования

- Go 1.22.6 или выше
- Telegram Bot API Token

## Установка

1. Клонируйте репозиторий:
   
   ```
   git clone https://github.com/Mr-Cheen1/Event.git
   cd Event
   ```

2. Установите зависимости:
   
   ```
   go mod tidy
   ```

3. Создайте файл `.env` в корневой директории проекта и добавьте следующие переменные:
   
   ```
   BOT_TOKEN=ваш_токен_бота
   CHAT_ID=идентификатор_чата
   ```

4. Настройте `config.json` и `events.json` файлы под свои нужды.

## Использование

Запустите бота командой:

```
go run main.go
```
## Конфигурация

### config.json

Этот файл содержит настройки времени отправки уведомлений и часового пояса:

{
"notification_time": "13:42",
"timezone": "Europe/Samara"
}

### events.json

Этот файл содержит список событий:

[
{
"date": "03.09",
"event": "День рождения Дмитрия"
},
{
"date": "02.09",
"event": "Годовщина свадьбы Анны и Вадима"
}
]

## Тестирование

Для запуска тестов используйте команду:

```
go test -race -count 100 ./...
```

## Принцип работы приложения:

1. Инициализация:
   - Приложение начинает работу с загрузки переменных окружения из файла .env, где хранятся токен бота и ID чата (см. main.go).
   - Затем загружается конфигурация из файла config.json, которая содержит время отправки уведомлений и часовой пояс (см. config/config.go).
   - Список событий загружается из файла events.json (см. events/events.go).

2. Настройка бота:
   - Создается экземпляр Telegram бота с использованием токена из переменных окружения (см. bot/bot.go).

3. Создание планировщика:
   - Создается экземпляр Scheduler, который управляет проверкой событий и отправкой уведомлений (см. events/events.go).

4. Основной цикл:
   - Планировщик входит в бесконечный цикл, где он постоянно проверяет текущее время (см. events/events.go).
   - Когда наступает время отправки уведомлений (указанное в config.json), запускается проверка событий.

5. Проверка событий:
   - Метод checkEvents в Scheduler проходит по всем событиям из events.json.
   - Для каждого события вычисляется количество дней до его наступления.
   - Если событие происходит сегодня или за 2 дня до события, формируется соответствующее сообщение.

6. Отправка уведомлений:
   - Если для события нужно отправить уведомление, оно отправляется в указанный Telegram чат с помощью бота (см. bot/bot.go).

7. Ожидание следующей проверки:
   - После проверки всех событий и отправки уведомлений, планировщик засыпает на 24 часа до следующей проверки.

8. Обработка ошибок:
   - На всех этапах работы приложения происходит логирование ошибок для облегчения отладки.

9. Тестирование:
   - Приложение включает модульные тесты для проверки корректности загрузки конфигурации, обработки событий и работы бота (см. *_test.go файлы).

## Структура проекта:

- event/ - Корневая директория проекта
  - .github/workflows/ - Директория с файлами для GitHub Actions
    - lint.yml - Настройки для линтинга кода
    - test.yml - Настройки для запуска тестов
    - build.yml - Настройки для сборки проекта
  - .env - Содержит переменные окружения (токен бота и ID чата)
  - .gitignore - Список игнорируемых Git'ом файлов
  - .golangci.yml - Конфигурация для golangci-lint
  - go.mod - Описание зависимостей проекта
  - go.sum - Хеши зависимостей для воспроизводимости сборки
  - main.go - Точка входа в приложение
  - README.md - Документация проекта
  - config.json - Конфигурационный файл (время уведомлений и часовой пояс)
  - events.json - Список событий
  - config/ - Пакет для работы с конфигурацией
    - config.go - Код для загрузки и обработки конфигурации
    - config_test.go - Тесты для конфигурации
  - events/ - Пакет для работы с событиями
    - events.go - Код для загрузки событий и планировщик
    - events_test.go - Тесты для обработки событий
  - bot/ - Пакет для работы с Telegram ботом
    - bot.go - Код для отправки сообщений через бота
    - bot_test.go - Тесты для функциональности бота